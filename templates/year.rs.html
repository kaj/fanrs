@use models::{Episode, Issue, Part, RefKey, Title};
@use templates::page;

@(year: u16, issues: &[(Issue, Vec<(Title, Episode, Vec<RefKey>, Part, Option<i16>, Option<i16>)>)])
@:page(&format!("Årgång {}", year), {
  <h1>@year</h1>
  @for (issue, content) in issues {
  <section class="issue" id="i@issue.number">
    <header>
      <h2>Nr @issue.number_str</h2>
      @if let Some(ref pages) = issue.pages {<p class="pages">@pages sidor</p>}
      @if let Some(ref price) = issue.price {<p class="price">Pris @price</p>}
    </header>
    <div class="content">
      @for (title, episode, refs, part, seqno, best_plac) in content {
      <div class="episode" @if let Some(seqno) = seqno {data-seq="@seqno"}>
	<h3><a href="/titles/@title.slug">@title.title</a>@if let Some(ref e) = episode.episode {: @e} @part</h3>
	@if let Some(ref teaser) = episode.teaser { <p class="teaser">@teaser</p> }
	@if let Some((last_ref, refs)) = refs.split_last()
	{<p class="info refs">Referenser: @for r in refs {@r, }@last_ref.</p>}
	@if let Some(ref note) = episode.note { <p class="info note">@note</p> }
	@if let Some(ref copyright) = episode.copyright { <p class="info copyright">Copyright @copyright</p> }
	@if let Some(plac) = best_plac { <p class="info best best@plac">Nummer @plac i omröstningen om bästa äventyr @year.</p>}
      </div>
      }
    </div>
  </section>
  }
})
