@use models::{Creator, Issue};
@use templates::page;
@use server::{PublishedInfo, PublishedContent::{EpisodePart, Text}};

@(year: u16, issues: &[(Issue, Vec<Creator>, Vec<PublishedInfo>)])
@:page(&format!("Årgång {}", year), {
  <h1>@year</h1>
  @for (issue, cover_by, contents) in issues {
  <section class="issue" id="i@issue.number">
    <header>
      <h2>Nr @issue.number_str</h2>
      @if let Some((last_c, creators)) = cover_by.split_last()
      {<p class="cover">Omslag av @for c in creators {@c, }@last_c.</p>}
      @if let Some(ref pages) = issue.pages {<p class="pages">@pages sidor</p>}
      @if let Some(ref price) = issue.price {<p class="price">Pris @price</p>}
    </header>
    <div class="content">
      @for PublishedInfo{content, seqno, classnames} in contents {
      <div class="@classnames" @if let Some(seqno) = seqno {data-seq="@seqno"}>
	@if let EpisodePart{title, episode, creators, refs, part, published, best_plac} = content {
	<h3><a href="/titles/@title.slug">@title.title</a>@if let Some(ref e) = episode.episode {: @e} @part</h3>
	@if let Some(ref teaser) = episode.teaser { <p class="teaser">@teaser</p> }
	@if let Some((last_ref, refs)) = refs.split_last()
	{<p class="info refs">Referenser: @for r in refs {@r, }@last_ref.</p>}
	@creators
	@if let Some(ref note) = episode.note { <p class="info note">@note</p> }
	@if let Some((last_pub, pubs)) = published.split_last()
	{<p class="info refs">Även publicerad i: @for p in pubs {@p, }@last_pub.</p>}
	@if let Some(ref copyright) = episode.copyright { <p class="info copyright">Copyright @copyright</p> }
	@if let Some(plac) = best_plac { <p class="info best best@plac">Nummer @plac i omröstningen om bästa äventyr @year.</p>}
	}
	@if let Text{title, subtitle, refs, note} = content {
	<h3>@title@if let Some(ref s) = subtitle {: @s}</h3>
	@if let Some((last_ref, refs)) = refs.split_last()
	{<p class="info refs">Referenser: @for r in refs {@r, }@last_ref.</p>}
	@if let Some(ref note) = note { <p class="info note">@note</p> }
	}
      </div>
      }
    </div>
  </section>
  }
})
